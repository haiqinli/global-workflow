<?xml version="1.0"?>
<!DOCTYPE workflow
[
	<!--
	PROGRAM
		Main workflow manager for Forecast only Global Forecast System

	AUTHOR:
		Rahul Mahajan
		rahul.mahajan@noaa.gov

	NOTES:
		This workflow was automatically generated at 2021-10-20 22:29:27.049975
	-->

	<!-- Experiment parameters such as name, cycle, resolution -->
	<!ENTITY PSLOT    "ws_ics">
	<!ENTITY CDUMP    "gdas">
	<!ENTITY CASE     "C768">
	<!ENTITY ECDUMP    "enkfgdas">
	<!ENTITY ECASE     "C384">

	<!-- Experiment parameters such as starting, ending dates -->
	<!ENTITY SDATE    "202008200000">
	<!ENTITY EDATE    "202008200000">
	<!ENTITY INTERVAL "24:00:00">

	<!-- Run Envrionment -->
	<!ENTITY RUN_ENVIR "emc">

	<!-- Experiment related directories -->
	<!ENTITY EXPDIR "/scratch2/BMC/gsd-fv3-dev/Judy.K.Henderson/test/gslv16_devops/FV3GFSwfm/ws_ics">
	<!ENTITY ROTDIR "/scratch2/BMC/gsd-fv3-dev/Judy.K.Henderson/test/gslv16_devops/FV3GFSrun/ws_ics">
	<!ENTITY WSICS_DIR "/scratch2/BMC/gsd-fv3-dev/Judy.K.Henderson/test/gslv16_devops/FV3GFSrun/WSICS">
	<!ENTITY FIXDIR "/scratch1/NCEPDEV/global/glopara/fix_nco_gfsv16">

	<!-- Directories for driving the workflow -->
	<!ENTITY HOMEgfs  "/scratch2/BMC/gsd-fv3-dev/Judy.K.Henderson/test/gslv16_devops">
	<!ENTITY JOBS_DIR "/scratch2/BMC/gsd-fv3-dev/Judy.K.Henderson/test/gslv16_devops/jobs/rocoto">

	<!-- Machine related entities -->
	<!ENTITY ACCOUNT    "gsd-fv3-dev">
	<!ENTITY QUEUE_DEBUG "debug">
	<!ENTITY QUEUE      "batch">
	<!ENTITY QUEUE_SERVICE "service">
	<!ENTITY PARTITION_SERVICE "service">
	<!ENTITY SCHEDULER  "slurm">

	<!-- Toggle HPSS archiving -->
	<!ENTITY ARCHIVE_TO_HPSS "YES">

	<!-- ROCOTO parameters that control workflow -->
	<!ENTITY CYCLETHROTTLE "2">
	<!ENTITY TASKTHROTTLE  "25">
	<!ENTITY MAXTRIES      "3">

	<!-- BEGIN: Resource requirements for the workflow -->

	<!ENTITY QUEUE_WSAEROIC_GDAS     "&QUEUE;">
	<!ENTITY QUEUE_WSAEROIC_GDAS     "&QUEUE_DEBUG;">
	<!ENTITY WALLTIME_WSAEROIC_GDAS  "00:30:00">
	<!ENTITY RESOURCES_WSAEROIC_GDAS "<nodes>1:ppn=3:tpp=1</nodes>">
	<!ENTITY RESOURCES_WSAEROIC_GDAS "<nodes>2:ppn=3:tpp=1</nodes>">
	<!ENTITY NATIVE_WSAEROIC_GDAS    "--export=NONE">

	<!-- END: Resource requirements for the workflow -->

]>

<workflow realtime="F" scheduler="&SCHEDULER;" cyclethrottle="&CYCLETHROTTLE;" taskthrottle="&TASKTHROTTLE;">

	<log verbosity="10"><cyclestr>&EXPDIR;/logs/@Y@m@d@H.log</cyclestr></log>

	<!-- Define the cycles -->
	<cycledef group="gdas">&SDATE; &EDATE; &INTERVAL;</cycledef>

<task name="gdaswsaeroic" cycledefs="gdas" maxtries="&MAXTRIES;">

	<command>&JOBS_DIR;/wsaeroic.sh</command>

	<jobname><cyclestr>&PSLOT;_gdaswsaeroic_@H</cyclestr></jobname>
	<account>&ACCOUNT;</account>
	<queue>&QUEUE_WSAEROIC_GDAS;</queue>
	&RESOURCES_WSAEROIC_GDAS;
	<walltime>&WALLTIME_WSAEROIC_GDAS;</walltime>
	
	<native>&NATIVE_WSAEROIC_GDAS;</native>

	<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gdaswsaeroic.log</cyclestr></join>

	<envar><name>HOMEgfs</name><value>&HOMEgfs;</value></envar>
	<envar><name>EXPDIR</name><value>&EXPDIR;</value></envar>
	<envar><name>AEROCASE</name><value>&CASE;</value></envar>
	<envar><name>yyyymmdd</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>WSICS_DIR</name><value>&WSICS_DIR;</value></envar>
	<envar><name>WSICS</name><value><cyclestr offset="-06:00:00">&WSICS_DIR;/&CDUMP;.@Y@m@d/@H/RESTART/</cyclestr></value></envar>
	<envar><name>TRACER_YMD</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>TRACER_HR</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>FIXfv3</name><value>&FIXDIR;/fix_fv3</value></envar>

	<dependency>
		<datadep><cyclestr offset="-06:00:00">&WSICS_DIR;/&CDUMP;.@Y@m@d/@H/</cyclestr>/RESTART/<cyclestr>@Y@m@d.@H0000.fv_tracer.res.tile6.nc</cyclestr></datadep>
	</dependency>

   </task>

<metatask name="enkfwsaeroic">
<!--
   <var name="member">001 002 003 004 005 006 007 008 009 010 011 012 013 014 015 016 017 018 019 020 021 022 023 024 025 026 027 028 029 030 031 032 033 034 035 036 037 038 039 040 </var> 
   <var name="member">005 </var> 
-->
   <var name="member">001 002 003 004 005 006 007 008 009 010 011 012 013 014 015 016 017 018 019 020 021 022 023 024 025 026 027 028 029 030 031 032 033 034 035 036 037 038 039 040 </var> 

   <task name="enkfwsaero#member#" maxtries="&MAXTRIES;">

	<command>&JOBS_DIR;/wsaeroic.sh</command>

	<jobname><cyclestr>&PSLOT;_enkfwsaeroic_@H</cyclestr></jobname>
	<account>&ACCOUNT;</account>
	<queue>&QUEUE_WSAEROIC_GDAS;</queue>
	&RESOURCES_WSAEROIC_GDAS;
	<walltime>&WALLTIME_WSAEROIC_GDAS;</walltime>
	<native>&NATIVE_WSAEROIC_GDAS;</native>

	<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/enkfwsaeroic#member#.log</cyclestr></join>

	<envar><name>HOMEgfs</name><value>&HOMEgfs;</value></envar>
	<envar><name>EXPDIR</name><value>&EXPDIR;</value></envar>
	<envar><name>AEROCASE</name><value>&ECASE;</value></envar>
	<envar><name>yyyymmdd</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>WSICS_DIR</name><value>&WSICS_DIR;</value></envar>
	<envar><name>WSICS</name><value><cyclestr offset="-06:00:00">&WSICS_DIR;/&ECDUMP;.@Y@m@d/@H/atmos/mem#member#/RESTART/</cyclestr></value></envar>
	<envar><name>TRACER_YMD</name><value><cyclestr offset="-03:00:00">@Y@m@d</cyclestr></value></envar>
	<envar><name>TRACER_HR</name><value><cyclestr offset="-03:00:00">@H</cyclestr></value></envar>
	<envar><name>FIXfv3</name><value>&FIXDIR;/fix_fv3</value></envar>

	<dependency>
		<datadep><cyclestr offset="-06:00:00">&WSICS_DIR;/&ECDUMP;.@Y@m@d/@H/</cyclestr>/atmos/mem#member#/RESTART/<cyclestr offset="-03:00:00">@Y@m@d.@H0000.fv_tracer.res.tile6.nc</cyclestr></datadep>
	</dependency>

   </task>
</metatask>

</workflow>
