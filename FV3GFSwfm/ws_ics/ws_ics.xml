<?xml version="1.0"?>
<!DOCTYPE workflow
[
	<!--
	PROGRAM
		Main workflow manager for Forecast only Global Forecast System

	AUTHOR:
		Rahul Mahajan
		rahul.mahajan@noaa.gov

	NOTES:
		This workflow was automatically generated at 2021-02-04 21:53:22.532596
	-->

	<!-- Experiment parameters such as name, cycle, resolution -->
	<!ENTITY PSLOT    "ws_ics">
	<!ENTITY CDUMP    "gdas">
	<!ENTITY CASE     "C768">

	<!-- Experiment parameters such as starting, ending dates -->
	<!ENTITY SDATE    "201912290000">
	<!ENTITY EDATE    "201912290000">
	<!ENTITY SDATE    "201910200000">
	<!ENTITY EDATE    "201910250000">
	<!ENTITY INTERVAL "120:00:00">

	<!-- Run Envrionment -->
	<!ENTITY RUN_ENVIR "emc">

	<!-- Experiment related directories -->
	<!ENTITY EXPDIR "/home/Judy.K.Henderson/scratch/update_jet//FV3GFSwfm/ws_ics">
	<!ENTITY ROTDIR "/home/Judy.K.Henderson/scratch/update_jet//FV3GFSrun/ws_ics">
        <!ENTITY WSICS_DIR "/lfs4/HFIP/gsd-fv3-hfip/jhender/scratch/wsICS">
        <!ENTITY FIXDIR "/lfs4/HFIP/hfv3gfs/glopara/git/fv3gfs/fix_nco_gfsv16/">

	<!-- Directories for driving the workflow -->
	<!ENTITY HOMEgfs  "/mnt/lfs4/HFIP/gsd-fv3-hfip/Judy.K.Henderson/scratch/update_jet">
	<!ENTITY JOBS_DIR "/mnt/lfs4/HFIP/gsd-fv3-hfip/Judy.K.Henderson/scratch/update_jet/jobs/rocoto">

	<!-- Machine related entities -->
	<!ENTITY ACCOUNT    "gsd-fv3-dev">
	<!ENTITY QUEUE      "batch">
	<!ENTITY QUEUE_DEBUG "debug">
	<!ENTITY QUEUE_SERVICE "service">
	<!ENTITY PARTITION_SERVICE "service">
	<!ENTITY SCHEDULER  "slurm">

	<!-- Toggle HPSS archiving -->
	<!ENTITY ARCHIVE_TO_HPSS "YES">

	<!-- ROCOTO parameters that control workflow -->
	<!ENTITY CYCLETHROTTLE "2">
	<!ENTITY TASKTHROTTLE  "25">
	<!ENTITY MAXTRIES      "2">

	<!-- BEGIN: Resource requirements for the workflow -->

        <!ENTITY QUEUE_AEROIC     "&QUEUE_DEBUG;">
        <!ENTITY QUEUE_AEROIC     "&QUEUE;">
	<!ENTITY PARTITION_AEROIC "vjet,xjet">
        <!ENTITY WALLTIME_AEROIC  "00:30:00">
        <!ENTITY WALLTIME_AEROIC  "00:40:00">
	<!ENTITY NATIVE_AEROIC    "--export=NONE">
        <!ENTITY RESOURCES_AEROIC "<nodes>2:ppn=3</nodes>">
        <!ENTITY RESOURCES_AEROIC "<nodes>1:ppn=3</nodes>">

	<!-- END: Resource requirements for the workflow -->

]>

<workflow realtime="F" scheduler="&SCHEDULER;" cyclethrottle="&CYCLETHROTTLE;" taskthrottle="&TASKTHROTTLE;">

	<log verbosity="10"><cyclestr>&EXPDIR;/logs/@Y@m@d@H.log</cyclestr></log>

	<!-- Define the cycles -->
	<cycledef group="gdas">&SDATE; &EDATE; &INTERVAL;</cycledef>

<task name="wsaeroic" cycledefs="gdas" maxtries="&MAXTRIES;">

	<command>&JOBS_DIR;/wsaeroic.sh</command>

	<jobname><cyclestr>&PSLOT;_wsaeroic_@H</cyclestr></jobname>
	<account>&ACCOUNT;</account>
	<queue>&QUEUE_AEROIC;</queue>
	<partition>&PARTITION_AEROIC;</partition>
	&RESOURCES_AEROIC;
	<walltime>&WALLTIME_AEROIC;</walltime>
	<native>&NATIVE_AEROIC;</native>

	<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/ws_aeroics.log</cyclestr></join>

	<envar><name>HOMEgfs</name><value>&HOMEgfs;</value></envar>
	<envar><name>EXPDIR</name><value>&EXPDIR;</value></envar>
	<envar><name>ROTDIR</name><value>&ROTDIR;</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>CDUMP</name><value>&CDUMP;</value></envar>
	<envar><name>CASE</name><value>&CASE;</value></envar>
	<envar><name>WSICS_DIR</name><value><cyclestr offset="-06:00:00">&WSICS_DIR;/&CDUMP;.@Y@m@d/@H/atmos/RESTART/</cyclestr></value></envar>
	<envar><name>FIXfv3</name><value>&FIXDIR;/fix_fv3</value></envar>

	<dependency>
		<datadep><cyclestr offset="-06:00:00">&WSICS_DIR;/&CDUMP;.@Y@m@d/@H</cyclestr>/atmos/RESTART/<cyclestr>@Y@m@d.@H0000.fv_tracer.res.tile6.nc</cyclestr></datadep>
	</dependency>

</task>

</workflow>
