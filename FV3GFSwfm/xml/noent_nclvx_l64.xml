<?xml version="1.0"?>
<!DOCTYPE workflow [
<!ENTITY FV3GFS_HOME "/home/rtfim/UFS-CAMsuite">
<!ENTITY PSLOT "rt_ufscam_l64">
<!ENTITY ATCFNAME "rt_ccpp_gsdsuite">
<!-- tracker name --><!ENTITY MODL "FV3-CCPP_gsdsuite">
<!-- plot name;  needs to have 'FV3' in name for NCL --><!ENTITY ANX_MODEL "GFS">
<!-- model analysis to use for AC stats --><!ENTITY AC_MODEL_NAME "rt_ccpp_gsdsuite">
<!-- AC stats name --><!ENTITY SOUNDING_MODEL_NAME "rt_ccpp_gsdsuite">
<!ENTITY SURFACE_MODEL_NAME "rt_ccpp_gsdsuite">
<!ENTITY RES "0p25">
<!ENTITY FCST_INTERVAL "6">
<!ENTITY FCST_LENGTH "168">
<!-- set this to 3 character str - ex. 96 would be 096 - used for final FV3GFS_GF verification file required --><!ENTITY FCST_LENGTH_STR "168">
<!-- External parameter entites --><!ENTITY % SITES SYSTEM "all_sites.xml">
<!ENTITY % jet SYSTEM "jet.xml">
<!ENTITY % jet_retro SYSTEM "jet_retro.xml">
<!ENTITY % hera SYSTEM "hera.xml">
<!ENTITY % hera_retro SYSTEM "hera_retro.xml">
<!ENTITY % TASKS SYSTEM "all_tasks.xml">
<!ENTITY nclzip_task SYSTEM "FV3GFS_NCLzip.xml">
<!ENTITY remapgrib_task SYSTEM "FV3GFS_RemapGrib.xml">
<!ENTITY ncl_task SYSTEM "FV3GFS_NCL.xml">
<!ENTITY nclfim_task SYSTEM "FV3GFS_NCLFim.xml">
<!ENTITY ac_verif_task SYSTEM "Global_Verif.xml">
<!ENTITY ac_verif_file_task SYSTEM "GFSVerifFileRealTime.xml">
<!ENTITY ac_verif_back_task SYSTEM "GFSVerifFileBackfill.xml">
<!ENTITY hfipPlot_task SYSTEM "FV3GFS_HfipPlots.xml">
<!ENTITY hfipPlotG1_task SYSTEM "FV3GFS_HfipPlotsG1.xml">
<!ENTITY % DEFS SYSTEM "all_defs.xml">
<!ENTITY % dbi SYSTEM "dbi.xml">
<!ENTITY % metatasks SYSTEM "metatask_defs.xml">
<!-- jet.xml --><!ENTITY SCHEDULER "slurm">
<!ENTITY PROJECT "gsd-fv3-dev">
<!ENTITY PE "batch">
<!ENTITY SERVICE "service">
<!ENTITY MET_MODULE "/contrib/met/modulefiles">
<!ENTITY MET_VERSION "met/8.0">
<!ENTITY FV3GFS_LOG "&FV3GFS_HOME;/FV3GFSwfm/log_&PSLOT;">
<!ENTITY FV3GFS_RUN "&FV3GFS_HOME;/FV3GFSrun">
<!ENTITY FV3GFS_WFM "&FV3GFS_HOME;/FV3GFSwfm">
<!ENTITY FV3GFS_POST_DIR "post/fim">
<!ENTITY SCRIPTS "&FV3GFS_HOME;/FV3GFSwfm/scripts">
<!ENTITY RTFIM_HOME "/home/rtfim">
<!ENTITY LFS4_ROOT "/lfs4/HFIP/gsd-fv3-hfip">
<!ENTITY CLIMATE_DIR "&LFS4_ROOT;/cmean/">
<!ENTITY PUB_DIR "/public">
<!ENTITY TRACKDIR "&FV3GFS_HOME;/tracks/">
<!ENTITY NCL_ROOT "&LFS4_ROOT;/rtruns/ncl/fimall">
<!ENTITY NCL_DIFF_HOME "&LFS4_ROOT;/rtruns/ncl/fimalldiff">
<!ENTITY CNVGRIB "cnvgrib">
<!ENTITY WGRIB "wgrib">
<!ENTITY WGRIB2 "wgrib2">
<!ENTITY GFS_VERIF_DIR "&PUB_DIR;/data/grids/gfs/0p5deg/grib2">
<!ENTITY GFS_VERIF_RETRO_DIR "&LFS4_ROOT;/GFS_RETRO_VERIF_FILES">
<!ENTITY FV3GFS_VERIF_DIR "&FV3GFS_RUN;">
<!ENTITY CDUMP "gfs">
<!ENTITY CASE "C768">
<!ENTITY PARTITION_JET "<partition>sjet,vjet,ujet,tjet,kjet,xjet</partition>">
<!-- verification  --><!ENTITY DBI_USER "wcron0_user">
<!ENTITY DBI_PASS "cohen_lee">
<!ENTITY DBI_DSN_AC "dbi:mysql:anom_corr2:host=137.75.133.134;port=3306">
<!ENTITY DBI_DSN_RUC_UA "dbi:mysql:ruc_ua:host=137.75.133.134;port=3306">
<!ENTITY DBI_DSN_SOUNDINGS "dbi:mysql:soundings:host=137.75.133.134;port=3306">
<!ENTITY DBI_DSN_MADIS "dbi:mysql:madis3:host=137.75.133.134;port=3306">
<!ENTITY DBI_DSN_SURFACE "dbi:mysql:surface_sums:host=137.75.133.134;port=3306">
<!-- ac stats vars --><!-- variables for anomaly correlation --><!ENTITY VARIABLES "HGT:UGRD:VGRD">
<!ENTITY NUM_VARIABLES "3">
<!ENTITY LEVELS "500:850,250:850,250">
<!-- levels for each variable (variable values separated by :) --><!ENTITY NUM_LEVELS "1:2:2">
<!-- levels for each variable (variable values separated by :) --><!-- strings needed for anomaly correlation - grib # must be correct - 7=HGT, 33=UGRD, 34=VGRD --><!ENTITY K_STRINGS "-t 'ano' -k '4*-1 7 100 :-t 'ano' -k '4*-1 33 100 :-t 'ano' -k '4*-1 34 100 :">
<!ENTITY FV3GFS_SOUNDINGS "&RTFIM_HOME;/fv3_soundings/fv3_soundings_grib2.x">
<!ENTITY FV3GFS_SURFACE "&RTFIM_HOME;/fim_surface/FIM_surface_realtime.x">
<!ENTITY fcst_240hr_metatask '<var name="fcst"> 0 6 12 18 24 30 36 42 48 54 60 66 72 78 84 90 96 102 108 114 120 126 132 138 144 150 156 162 168 174 180 186 192 198 204 210 216 222 228 234 240 </var>'>
<!ENTITY fcst_168hr_metatask '<var name="fcst"> 0 6 12 18 24 30 36 42 48 54 60 66 72 78 84 90 96 102 108 114 120 126 132 138 144 150 156 162 168 </var>'>
<!ENTITY fcst_120hr_metatask '<var name="fcst"> 0 6 12 18 24 30 36 42 48 54 60 66 72 78 84 90 96 102 108 114 120 </var>'>
<!ENTITY t240hr_metatask '<var name="T"> 000 006 012 018 024 030 036 042 048 054 060 066 072 078 084 090 096 102 108 114 120 126 132 138 144 150 156 162 168 174 180 186 192 198 204 210 216 222 228 234 240 </var>'>
<!ENTITY t168hr_metatask '<var name="T"> 000 006 012 018 024 030 036 042 048 054 060 066 072 078 084 090 096 102 108 114 120 126 132 138 144 150 156 162 168 </var>'>
<!ENTITY t120hr_metatask '<var name="T"> 000 006 012 018 024 030 036 042 048 054 060 066 072 078 084 090 096 102 108 114 120 </var>'>
<!ENTITY sounding_240hr_metatask '<var name="fcst">000 012 024 036 048 060 072 084 096 108 120 132 144 156 168 180 192 204 216 228 240 </var>'>
<!ENTITY sounding_168hr_metatask '<var name="fcst">000 012 024 036 048 060 072 084 096 108 120 132 144 156 168 </var>'>
<!ENTITY sounding_120hr_metatask '<var name="fcst">000 012 024 036 048 060 072 084 096 108 120 </var>'>
<!ENTITY surface_72hr_metatask '<var name="fcst">000 006 012 018 024 030 036 042 048 054 060 066 072 078 084 090 096 102 108 114 120 </var>'>
]>
<workflow realtime="T" scheduler="slurm" cyclethrottle="4">
  <log>
    <cyclestr>/home/rtfim/UFS-CAMsuite/FV3GFSwfm/log_rt_ufscam_l64/workflow/workflow_@Y@m@d@H_rt_ufscam_l64_vxncl.log</cyclestr>
  </log>

  <cycledef group="accvx"> 202008190000 202905010000 12:00:00</cycledef>
  <cycledef group="24hr">202008190000 202905010000 24:00:00</cycledef>

  <!-- get the ANX files needed for verification -->
  <task name="ANX_verif_file_realtime" cycledefs="accvx" maxtries="4">
    <command>/home/rtfim/UFS-CAMsuite/FV3GFSwfm/scripts/anx_verif_file_realtime.ksh</command>
    <account>gsd-fv3-dev</account>
    <cores>1</cores>
    <partition>service</partition>
    <walltime>00:10:00</walltime>
    <jobname><cyclestr>ANXFile_@H</cyclestr></jobname>
    <join><cyclestr>/home/rtfim/UFS-CAMsuite/FV3GFSwfm/log_rt_ufscam_l64/gfsfile/ANXFile_@Y@m@d@H.log</cyclestr></join>
    <envar><name>WFM</name><value>1</value></envar>
    <envar><name>GLOBAL_RUN</name><value>/home/rtfim/UFS-CAMsuite/FV3GFSrun/rt_ufscam_l64</value></envar>
    <envar><name>ANX_DIR</name><value>/public/data/grids/gfs/0p5deg/grib2</value></envar>
    <envar><name>HOUR</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>yyyymmddhhmm</name><value><cyclestr>@Y@m@d@H@M</cyclestr></value></envar>
    <envar><name>ANX_MODEL</name><value>GFS</value></envar>
    <envar><name>CNVGRIB</name><value>cnvgrib</value></envar>
    <dependency>
        <datadep age="120"><cyclestr>/public/data/grids/gfs/0p5deg/grib2/@y@j@H@M0000</cyclestr></datadep>
    </dependency>
  </task>

    <task name="GlobalVerif" cycledefs="accvx" maxtries="3">
    <command>/home/rtfim/UFS-CAMsuite/FV3GFSwfm/scripts/ACVerif.ksh</command>
    <account>gsd-fv3-dev</account>
    <partition>service</partition>
    <walltime>00:40:00</walltime>
    <cores>1</cores>
    <jobname><cyclestr>GlobalVerif_@H</cyclestr></jobname>
    <join><cyclestr>/home/rtfim/UFS-CAMsuite/FV3GFSwfm/log_rt_ufscam_l64/verif/GlobalVerif_@Y@m@d@H_FV3-CCPP_gsdsuite.log</cyclestr></join>
    <envar><name>GLOBAL_HOME</name><value>/home/rtfim/UFS-CAMsuite</value></envar>
    <envar><name>GLOBAL_RUN</name><value>/home/rtfim/UFS-CAMsuite/FV3GFSrun/rt_ufscam_l64</value></envar>
    <envar><name>GLOBAL_POST_DIR</name><value>post/fim</value></envar>
    <!-- OPS uses the GSD /public directory structure, which contains files from EMC-->
    <!-- EXP uses the GSD FIM workflow directory structure-->
    <!-- EXP uses the GSD FV3 workflow directory structure-->
    <envar><name>GLOBAL_TYPE</name><value>FV3</value></envar>
    <envar><name>SCRIPTS</name><value>/home/rtfim/UFS-CAMsuite/FV3GFSwfm/scripts</value></envar>
    <envar><name>CFG_FILE</name><value>/home/rtfim/UFS-CAMsuite/FV3GFSwfm/scripts/GridStatACConfig</value></envar>
    <envar><name>LOG_DIR</name><value>/home/rtfim/UFS-CAMsuite/FV3GFSwfm/log_rt_ufscam_l64/verif</value></envar>
    <envar><name>yyyymmddhhmm</name><value><cyclestr>@Y@m@d@H@M</cyclestr></value></envar>
    <envar><name>MET_MODULE</name><value>/contrib/met/modulefiles</value></envar>
    <envar><name>MET_VERSION</name><value>met/8.0</value></envar>
    <envar><name>ANALYSIS</name><value>GFS</value></envar>
    <envar><name>ANX_VERIF_DIR</name><value><cyclestr>/home/rtfim/UFS-CAMsuite/FV3GFSrun/rt_ufscam_l64/gfs.@Y@m@d/@H/verif/GFS</cyclestr></value></envar>
    <envar><name>GLOBAL_DATA_DIR</name><value>/home/rtfim/UFS-CAMsuite/FV3GFSrun</value></envar>
    <envar><name>CLIMATE_FILE</name><value><cyclestr>/lfs4/HFIP/gsd-fv3-hfip/cmean//cmean_1d.1959@m@d</cyclestr></value></envar>
    <envar><name>MODEL</name><value>rt_ccpp_gsdsuite</value></envar>
    <envar><name>DBI_USER</name><value>wcron0_user</value></envar>
    <envar><name>DBI_PASS</name><value>cohen_lee</value></envar>
    <dependency>
     <and>
       <datadep age="120"><cyclestr>/home/rtfim/UFS-CAMsuite/FV3GFSrun/rt_ufscam_l64/gfs.@Y@m@d/@H/verif/GFS/@y@j@H@M0000</cyclestr></datadep>
       <datadep age="300"><cyclestr>/home/rtfim/UFS-CAMsuite/FV3GFSrun/rt_ufscam_l64/gfs.@Y@m@d/@H/post/fim/@y@j@H@M0000.g2</cyclestr></datadep>
      </and>
    </dependency>
  </task>


<!--
 <metatask throttle="38">
    &sounding_168hr_metatask;
    &sounding_task;
  </metatask>
-->

  <metatask name="remap_ncl" throttle="25">
<!--
     var name="fcst"> 0 6 12 18 24 30 36 42 48 54 60 66 72 78 84 90 96 102 108 114 120 126 132 138 144 150 156 162 168 </var>
     var name="T"> 000 006 012 018 024 030 036 042 048 054 060 066 072 078 084 090 096 102 108 114 120 132 138 144 150 156 162 168 </var>-->
    <var name="fcst"> 0 6 12 18 24 30 36 42 48 54 60 66 72 78 84 90 96 102 108 114 120 126 132 138 144 150 156 162 168 </var>
    <var name="T"> 000 006 012 018 024 030 036 042 048 054 060 066 072 078 084 090 096 102 108 114 120 126 132 138 144 150 156 162 168 </var>
      <task name="remapgrib_#T#" cycledefs="24hr" maxtries="4">
    <command>/home/rtfim/UFS-CAMsuite/FV3GFSwfm/scripts/remapgrib.ksh</command>
    <account>gsd-fv3-dev</account>
    <cores>1</cores>
    <partition>sjet,vjet,ujet,tjet,kjet,xjet</partition>
    <walltime>00:35:00</walltime>
    <jobname><cyclestr>remapgrib</cyclestr></jobname>
    <join><cyclestr>/home/rtfim/UFS-CAMsuite/FV3GFSwfm/log_rt_ufscam_l64/remapgrib/remapgrib_@Y@m@d@H_#T#.log</cyclestr></join>
    <envar><name>FV3GFS_RUN</name><value>/home/rtfim/UFS-CAMsuite/FV3GFSrun</value></envar>
    <envar><name>PSLOT</name><value>rt_ufscam_l64</value></envar>
    <envar><name>CDUMP</name><value>gfs</value></envar>
    <envar><name>yyjjjhh</name><value><cyclestr>@y@j@H</cyclestr></value></envar>
    <envar><name>yyyymmdd</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>hh</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>fcst</name><value>#T#</value></envar>
    <envar><name>GRID_NAMES</name><value>201D130D244D236D224D242</value></envar>
    <dependency>
      <datadep age="120"><cyclestr>/home/rtfim/UFS-CAMsuite/FV3GFSrun/rt_ufscam_l64/gfs.@Y@m@d/@H/gfs.t@Hz.pgrb2.0p25.f#T#</cyclestr></datadep>
    </dependency>
  </task>

      <task name="ncl_#T#" cycledefs="24hr" maxtries="5">
    <command>/home/rtfim/UFS-CAMsuite/FV3GFSwfm/scripts/nclfv3_driver.ksh</command>
    <account>gsd-fv3-dev</account>
    <memory>4G</memory>
    <cores>1</cores>
    <walltime>02:30:00</walltime>
    <partition>sjet,vjet,xjet</partition>
    <jobname><cyclestr>ncl_#T#</cyclestr></jobname>
    <join><cyclestr>/home/rtfim/UFS-CAMsuite/FV3GFSwfm/log_rt_ufscam_l64/ncl/ncl#T#_@Y@m@d@H00.log</cyclestr></join>
    <envar><name>FV3GFS_HOME</name><value>/home/rtfim/UFS-CAMsuite</value></envar>
    <envar><name>FV3GFS_RUN</name><value><cyclestr>/home/rtfim/UFS-CAMsuite/FV3GFSrun/rt_ufscam_l64/gfs.@Y@m@d/@H/</cyclestr></value></envar>
    <envar><name>SCRIPTS</name><value>/home/rtfim/UFS-CAMsuite/FV3GFSwfm/scripts</value></envar>
    <envar><name>PSLOT</name><value>rt_ufscam_l64</value></envar>
    <envar><name>NCL_ROOT</name><value>/lfs4/HFIP/gsd-fv3-hfip/rtruns/ncl/fimall</value></envar>
    <envar><name>NCL_HOME</name><value>/lfs4/HFIP/gsd-fv3-hfip/rtruns/ncl/fimall</value></envar>
    <envar><name>MODL</name><value>FV3-CCPP_gsdsuite</value></envar>
    <envar><name>ATCFNAME</name><value>rt_ccpp_gsdsuite</value></envar>
    <envar><name>yyyymmdd</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>H</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>yyjjjhhmm</name><value><cyclestr>@y@j@H00</cyclestr></value></envar>
    <envar><name>CDUMP</name><value>gfs</value></envar>
    <envar><name>RES</name><value>0p25</value></envar>
    <envar><name>T</name><value>#T#</value></envar>
    <envar><name>FCST_TIME</name><value>#fcst#</value></envar>
    <envar><name>FCST_LENGTH</name><value>168</value></envar>
    <envar><name>GRID_NAMES</name><value>fimD201D130D244D236D224D242</value></envar>
<!--     <envar><name>GRID_NAMES</name><value>fimD201D130D244D236D242</value></envar>
    <envar><name>GRID_NAMES</name><value>fim</value></envar>--> 
    <dependency>
       <and>
         <datadep age="120"> <cyclestr>/home/rtfim/UFS-CAMsuite/FV3GFSrun/rt_ufscam_l64/gfs.@Y@m@d/@H/gfs.t@Hz.pgrb2.0p25.f#T#</cyclestr></datadep>
         <datadep age="120"><cyclestr>/home/rtfim/UFS-CAMsuite/FV3GFSrun/rt_ufscam_l64/gfs.@Y@m@d/@H/post/201/@y@j@H@M0#T#.g2</cyclestr></datadep>
         <datadep age="120"><cyclestr>/home/rtfim/UFS-CAMsuite/FV3GFSrun/rt_ufscam_l64/gfs.@Y@m@d/@H/post/130/@y@j@H@M0#T#.g2</cyclestr></datadep>
         <datadep age="120"><cyclestr>/home/rtfim/UFS-CAMsuite/FV3GFSrun/rt_ufscam_l64/gfs.@Y@m@d/@H/post/244/@y@j@H@M0#T#.g2</cyclestr></datadep>
         <datadep age="120"><cyclestr>/home/rtfim/UFS-CAMsuite/FV3GFSrun/rt_ufscam_l64/gfs.@Y@m@d/@H/post/236/@y@j@H@M0#T#.g2</cyclestr></datadep>
         <datadep age="120"><cyclestr>/home/rtfim/UFS-CAMsuite/FV3GFSrun/rt_ufscam_l64/gfs.@Y@m@d/@H/post/224/@y@j@H@M0#T#.g2</cyclestr></datadep>
         <datadep age="120"><cyclestr>/home/rtfim/UFS-CAMsuite/FV3GFSrun/rt_ufscam_l64/gfs.@Y@m@d/@H/post/242/@y@j@H@M0#T#.g2</cyclestr></datadep>
       </and>
    </dependency>
  </task>

  </metatask>
    <task name="nclzip" cycledefs="24hr" maxtries="3">
    <command>/home/rtfim/UFS-CAMsuite/FV3GFSwfm/scripts/fv3_nclzip.ksh</command>
    <account>gsd-fv3-dev</account>
    <cores>1</cores>
    <walltime>00:55:00</walltime>
    <jobname><cyclestr>nclzip</cyclestr></jobname>
    <join><cyclestr>/home/rtfim/UFS-CAMsuite/FV3GFSwfm/log_rt_ufscam_l64/ncl/nclzip_@Y@m@d@H.log</cyclestr></join>
    <envar><name>FV3GFS_RUN</name><value>/home/rtfim/UFS-CAMsuite/FV3GFSrun</value></envar>
    <envar><name>yyyymmdd</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>PSLOT</name><value>rt_ufscam_l64</value></envar>
    <envar><name>CDUMP</name><value>gfs</value></envar>
    <envar><name>hh</name><value><cyclestr>@H</cyclestr></value></envar>
    <dependency>
        <metataskdep metatask="remap_ncl"/>
    </dependency>
  </task>
 

</workflow>
