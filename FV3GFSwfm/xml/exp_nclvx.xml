<?xml version="1.0"?>
<!DOCTYPE workflow [

  <!ENTITY EXP_HOME "/scratch2/BMC/gsd-fv3-dev/test/nclvx/">
  <!ENTITY FV3GFS_HOME "/scratch2/BMC/gsd-fv3-dev/test/nclvx/">
  <!ENTITY PSLOT  "GSLnoah">
  <!ENTITY ATCFNAME "FV3GSLnoah">               <!-- tracker name -->
  <!ENTITY MODL "FV3GSLnoah">                   <!-- plot name;  needs to have 'FV3' in name for NCL -->
  <!ENTITY ANX_MODEL "GFS">                     <!-- model analysis to use for AC stats -->
  <!ENTITY ATCFNAME "FV3GSLnoah">               <!-- tracker name -->
  <!ENTITY AC_MODEL_NAME "FV3GSLnoah">          <!-- AC stats name -->
  <!ENTITY SOUNDING_MODEL_NAME "FV3GSLnoah">
  <!ENTITY SURFACE_MODEL_NAME "FV3GSLnoah">
  <!ENTITY RES "0p25">
  <!ENTITY FCST_INTERVAL "6">
  <!ENTITY FCST_LENGTH "168">
  <!-- set this to 3 character str - ex. 96 would be 096 - used for final FV3GFS_GF verification file required -->
  <!ENTITY FCST_LENGTH_STR "168">

  <!-- External parameter entites -->
  <!ENTITY % SITES  SYSTEM "all_sites.xml">  %SITES;
  <!ENTITY % TASKS  SYSTEM "all_tasks.xml">  %TASKS;
  <!ENTITY % DEFS   SYSTEM "all_defs.xml">   %DEFS;

<!--  uncomment the line below if you do not have 'atmos' in your paths -->
<!--  <!ENTITY COMPONENT   "">  -->
  %hera;
  %dbi;
  %metatasks;
]>

<workflow realtime="F" scheduler="&SCHEDULER;" cyclethrottle="4">
  <log>
    <cyclestr>&FV3GFS_LOG;/workflow/workflow_@Y@m@d@H_nclvx.log</cyclestr>
  </log>

  <!--  
        accvx is used for Anomaly Corr
        sfcvx is used for surface verification 
        raobvx is used for raob verification
        nclcyc is used for NCL images

        anomaly corr is run every 12 hours over time range [00z, 12z]
        surface vx is run every 06 hours over time range   [00z, 06z, 12z, 18z]
        raob vx and ncl images are run for each initialization time  [every 10 days for 2016 retro]
                                                                     [every 05 days for 2019 retro]
                                                                     [every day at 00Z for realtime]  

  <cycledef group="nclcyc"> 201601010000 201603310000 240:00:00</cycledef> 
  <cycledef group="accvx">  201601010000 201603310000 12:00:00 </cycledef> 
  <cycledef group="raobvx"> 201601010000 201603310000 240:00:00 </cycledef> 
  -->

  <cycledef group="nclcyc"> 201910200000 201912310000 120:00:00</cycledef> 
  <cycledef group="accvx">  201910200000 201912310000 12:00:00</cycledef> 
  <cycledef group="raobvx"> 201910200000 201912310000 120:00:00</cycledef> 
<!--  <cycledef group="sfcvx">  201910200000 201912310000 06:00:00</cycledef> -->

  <!--  Anomaly Correlation  -->
  &ac_verif_back_task; 
  &ac_verif_task;

  <!--  Raob Verification  -->
  <metatask throttle="38">
    &sounding_168hr_metatask;
    &sounding_task;
  </metatask>

  <!--  Surface Verification 
  <metatask>
    &surface_72hr_metatask;
    &surface_task;
  </metatask> -->

  <!--  NCL Images -->
  <metatask name="remap_ncl" throttle="25">
    &fcst_168hr_metatask;
    &t168hr_metatask;
    &remapgrib_task; 
    &ncl_task;
  </metatask>
  &nclzip_task;  

</workflow>
